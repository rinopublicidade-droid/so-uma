<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>S√≥ Uma ‚Äî Baralho inspirado</title>

  <style>
    :root{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

      --bg1:#0b0f17;
      --bg2:#0e1630;
      --card:#101a2b;
      --stroke: rgba(255,255,255,.10);
      --text:#f3f6ff;
      --muted: rgba(243,246,255,.75);

      --radius: 24px;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --shadow-soft: 0 12px 30px rgba(0,0,0,.25);
    }

    body{
      margin:0;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(255,210,90,.15), transparent 55%),
        radial-gradient(900px 700px at 80% 20%, rgba(90,200,255,.14), transparent 55%),
        radial-gradient(900px 700px at 60% 90%, rgba(170,120,255,.13), transparent 55%),
        linear-gradient(180deg, var(--bg2), var(--bg1));
      min-height: 100vh;
    }

    /* ====== Modo Festa (cores + vibes) ====== */
    body.festa{
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(255,120,170,.20), transparent 55%),
        radial-gradient(900px 700px at 80% 20%, rgba(90,255,190,.16), transparent 55%),
        radial-gradient(900px 700px at 60% 90%, rgba(170,120,255,.18), transparent 55%),
        linear-gradient(180deg, #10123a, #0b0f17);
    }
    body.festa .title-badge{
      background: linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border-color: rgba(255,255,255,.18);
    }
    body.festa h1{
      letter-spacing: .6px;
    }
    body.festa .logo-dot{
      box-shadow: 0 0 30px rgba(255,255,255,.28);
    }

    .wrap{
      max-width: 920px;
      margin: 0 auto;
      padding: 22px;
    }

    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    h1{
      margin:0;
      font-size: 22px;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:10px;
    }

    .logo-dot{
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255,206,86,.95), rgba(54,162,235,.95));
      border: 1px solid rgba(255,255,255,.25);
      display:inline-block;
    }

    .subtitle{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .title-badge{
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--stroke);
      backdrop-filter: blur(8px);
      box-shadow: var(--shadow-soft);
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap:wrap;
    }

    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding: 8px 12px; border-radius: 999px;
      background: rgba(255,255,255,.07);
      border: 1px solid var(--stroke);
      font-size: 13px;
      backdrop-filter: blur(6px);
      user-select:none;
    }
    .pill b{ font-weight: 900; }

    /* ====== Palco 3D (flip) ====== */
    .stage{
      perspective: 1200px;
      width: 100%;
    }

    .card3d{
      position: relative;
      transform-style: preserve-3d;
      transition: transform .55s cubic-bezier(.2,.7,.2,1);
      border-radius: var(--radius);
    }

    .card3d.flipping{
      transform: rotateY(180deg);
    }

    .face{
      backface-visibility: hidden;
      border-radius: var(--radius);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    /* Frente (conte√∫do do jogo) */
    .face.front{
      background:
        radial-gradient(1000px 700px at 10% 0%, rgba(255,255,255,.08), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.06), transparent 35%),
        var(--card);
      padding: 18px;
      position: relative;
    }

    /* Textura ‚Äúpapel‚Äù sutil (sem imagem externa) */
    .face.front::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        repeating-linear-gradient(45deg, rgba(255,255,255,.025), rgba(255,255,255,.025) 2px, transparent 2px, transparent 6px),
        radial-gradient(600px 400px at 80% 20%, rgba(255,255,255,.04), transparent 55%),
        radial-gradient(700px 500px at 20% 90%, rgba(255,255,255,.03), transparent 60%);
      opacity: .7;
      pointer-events:none;
      mix-blend-mode: overlay;
    }

    .face.front > *{
      position: relative;
      z-index: 1;
    }

    /* Verso (s√≥ est√©tica) */
    .face.back{
      transform: rotateY(180deg);
      background:
        radial-gradient(900px 700px at 30% 20%, rgba(255,255,255,.10), transparent 55%),
        linear-gradient(135deg, rgba(255,206,86,.18), rgba(153,102,255,.14)),
        #0f1b33;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height: 220px;
      padding: 22px;
      position:absolute;
      inset:0;
    }

    .backMark{
      text-align:center;
      opacity:.95;
      max-width: 520px;
      user-select:none;
    }
    .backMark .big{
      font-size: 28px;
      font-weight: 1000;
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    .backMark .small{
      font-size: 13px;
      color: rgba(243,246,255,.78);
      line-height:1.4;
    }

    /* ====== Conte√∫do ====== */
    .meta{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-bottom: 12px;
    }

    .words{
      display:grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 12px;
      margin-top: 14px;
    }

    /* ‚ÄúCartinhas coloridas‚Äù por op√ß√£o */
    .word{
      position: relative;
      padding: 14px 14px 14px 16px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      overflow:hidden;
      display:flex;
      justify-content: space-between;
      align-items:center;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: .35px;
      text-transform: uppercase;
      user-select:none;
    }

    /* faixa lateral */
    .word::before{
      content:"";
      position:absolute;
      left:0; top:0; bottom:0;
      width: 10px;
      background: rgba(255,255,255,.35);
    }

    /* brilho */
    .word::after{
      content:"";
      position:absolute;
      inset:-45%;
      background: radial-gradient(circle at 20% 30%, rgba(255,255,255,.22), transparent 52%);
      transform: rotate(10deg);
      opacity: .6;
      pointer-events:none;
    }

    .word > span{ position: relative; z-index: 1; }
    .idx{
      position: relative; z-index: 1;
      opacity: .9;
      font-size: 12px;
      font-weight: 1000;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.18);
    }

    /* Paletas por posi√ß√£o 1‚Äì5 */
    .c1{ background: linear-gradient(135deg, rgba(255,99,132,.34), rgba(255,99,132,.12)); }
    .c1::before{ background: rgba(255,99,132,.95); }

    .c2{ background: linear-gradient(135deg, rgba(255,206,86,.36), rgba(255,206,86,.12)); }
    .c2::before{ background: rgba(255,206,86,.95); }

    .c3{ background: linear-gradient(135deg, rgba(75,192,192,.34), rgba(75,192,192,.12)); }
    .c3::before{ background: rgba(75,192,192,.95); }

    .c4{ background: linear-gradient(135deg, rgba(54,162,235,.34), rgba(54,162,235,.12)); }
    .c4::before{ background: rgba(54,162,235,.95); }

    .c5{ background: linear-gradient(135deg, rgba(153,102,255,.34), rgba(153,102,255,.12)); }
    .c5::before{ background: rgba(153,102,255,.95); }

    /* ====== Alvo ====== */
    .target{
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(90, 200, 255, .10);
      border: 1px solid rgba(90, 200, 255, .22);
      display:none;
    }
    .target strong{ font-size: 15px; }

    /* ====== Controles ====== */
    .controls{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 16px;
    }

    button{
      cursor:pointer;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.09);
      color: var(--text);
      padding: 11px 14px;
      border-radius: 14px;
      font-weight: 900;
      letter-spacing:.2px;
      backdrop-filter: blur(6px);
      transition: transform .06s ease, background .2s ease;
      user-select:none;
    }
    button:hover{ background: rgba(255,255,255,.13); }
    button:active{ transform: translateY(1px); }

    .danger{
      background: rgba(255, 90, 90, .14);
      border-color: rgba(255,90,90,.35);
    }
    .danger:hover{ background: rgba(255, 90, 90, .18); }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
      align-items:center;
    }

    label.pill{
      gap:10px;
      cursor:pointer;
    }
    input[type="checkbox"]{ transform: scale(1.1); cursor:pointer; }

    .hint{
      color: var(--muted);
      font-size: 13px;
      margin-top: 10px;
      line-height:1.35;
    }

    /* ====== Confete (Modo Festa) ====== */
    canvas#confetti{
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0;
      transition: opacity .25s ease;
    }
    body.festa canvas#confetti{
      opacity: 1;
    }

    /* ====== Modo Adivinhador ====== */
    .modeBadge{
      font-weight: 1000;
      text-transform: uppercase;
      letter-spacing: .6px;
    }
    .adivinhador .target,
    .adivinhador #pickBtn,
    .adivinhador #showTargetPill{
      display: none !important;
    }
    .adivinhador .hint::before{
      content:"Modo Adivinhador: ";
      font-weight: 900;
      color: rgba(255,255,255,.9);
    }
  </style>
</head>

<body>
  <canvas id="confetti"></canvas>

  <div class="wrap">
    <div class="topbar">
      <div>
        <h1><span class="logo-dot"></span> S√≥ Uma ‚Äî baralho inspirado</h1>
        <div class="subtitle">
          Cartas aleat√≥rias sem repetir at√© acabar o ciclo. Visual ‚Äúparty game‚Äù com cores por op√ß√£o.
        </div>
      </div>

      <div class="title-badge">
        <span class="pill">üé≠ Modo: <b id="modeLabel" class="modeBadge">Mestre</b></span>
        <label class="pill" title="Deixa o visual mais ‚Äúfesta‚Äù e liga um confete discreto">
          <input id="festaToggle" type="checkbox" />
          Modo Festa
        </label>
        <label class="pill" title="Esconde alvo e n√∫mero sorteado">
          <input id="adivToggle" type="checkbox" />
          Modo Adivinhador
        </label>
      </div>
    </div>

    <div class="stage">
      <div id="card3d" class="card3d">
        <div class="face front">
          <div class="meta">
            <span class="pill">üìÑ Carta: <b id="cardNumber">‚Äî</b></span>
            <span class="pill">üÉè Restantes no ciclo: <b id="remaining">‚Äî</b></span>
            <span class="pill">üéØ N√∫mero sorteado: <b id="pickedNumber">‚Äî</b></span>
          </div>

          <div id="words" class="words"></div>

          <div id="targetBox" class="target">
            <div><strong>Alvo (n¬∫ <span id="targetN">‚Äî</span>):</strong> <span id="targetWord">‚Äî</span></div>
          </div>

          <div class="controls">
            <button id="nextBtn">Nova carta</button>
            <button id="pickBtn">Sortear n√∫mero (1‚Äì5)</button>
            <button class="danger" id="resetBtn">Reiniciar ciclo</button>
          </div>

          <div class="row">
            <label id="showTargetPill" class="pill">
              <input id="showTarget" type="checkbox" />
              Mostrar alvo
            </label>
          </div>

          <div class="hint" id="hintText">
            Dica: no jogo original, o ‚Äúalvo‚Äù costuma ficar s√≥ com o grupo. Aqui voc√™ controla.
          </div>
        </div>

        <div class="face back">
          <div class="backMark">
            <div class="big">S√≥ Uma</div>
            <div class="small">
              Baralho inspirado ‚Ä¢ Visual alegre ‚Ä¢ Sem repetir no ciclo<br/>
              Clique em <b>Nova carta</b> para virar a rodada.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ======= BARALHO (110 CARTAS) =======
    const DECK = [
      // 1 - 30
      ["Sol","Praia","Calor","Ver√£o","Bronzeado"],
      ["Cachorro","Latido","Coleira","Osso","Amigo"],
      ["Escola","Professor","Aula","Prova","Caderno"],
      ["Pizza","Forno","Mussarela","Fatia","It√°lia"],
      ["Chuva","Guarda-chuva","Molhado","Nuvem","Temporal"],
      ["Futebol","Gol","Torcida","Est√°dio","Bola"],
      ["Celular","Tela","Aplicativo","Mensagem","Bateria"],
      ["Caf√©","X√≠cara","Amargo","Manh√£","Energia"],
      ["Viagem","Mala","Avi√£o","Hotel","F√©rias"],
      ["M√©dico","Hospital","Consulta","Receita","Sa√∫de"],
      ["Livro","P√°gina","Autor","Leitura","Biblioteca"],
      ["Festa","M√∫sica","Dan√ßa","Bal√£o","Alegria"],
      ["Frio","Casaco","Inverno","Cachecol","Geada"],
      ["Cinema","Filme","Pipoca","Tela","Sess√£o"],
      ["Rel√≥gio","Hora","Atraso","Ponteiro","Alarme"],
      ["Crian√ßa","Brinquedo","Escola","Sorriso","Parquinho"],
      ["Dinheiro","Carteira","Compra","Pre√ßo","Troco"],
      ["Natal","Presente","Papai Noel","√Årvore","Fam√≠lia"],
      ["Internet","Wi-Fi","Conex√£o","Site","Senha"],
      ["Cozinha","Fog√£o","Receita","Panela","Temperar"],
      ["Tr√¢nsito","Sem√°foro","Engarrafamento","Buzina","Rua"],
      ["Amizade","Confian√ßa","Risada","Apoio","Companhia"],
      ["Academia","Peso","Treino","Suor","M√∫sculo"],
      ["Praia","Areia","Onda","Mar","Protetor"],
      ["Professor","Lousa","Explica√ß√£o","Prova","Ensino"],
      ["Festa Junina","Fogueira","Milho","Quadrilha","Bal√£o"],
      ["Trabalho","Reuni√£o","Prazo","Meta","Resultado"],
      ["Cidade","Rua","Bairro","Pra√ßa","Movimento"],
      ["Sorvete","Frio","Doce","Casquinha","Ver√£o"],
      ["Amor","Cora√ß√£o","Cuidado","Abra√ßo","Afeto"],

      // 31 - 110
      ["M√∫sica","Fone","Volume","Playlist","Ritmo"],
      ["Chave","Porta","Fechadura","Cadeado","Acesso"],
      ["Mercado","Carrinho","Oferta","Caixa","Compra"],
      ["Escola","Recreio","Amigo","Brincadeira","Intervalo"],
      ["M√©dico","Estetosc√≥pio","Batimento","Exame","Diagn√≥stico"],
      ["Filme","Diretor","Cena","Ator","Oscar"],
      ["Crian√ßa","Colo","Cuidado","Choro","Carinho"],
      ["Foto","C√¢mera","Clique","√Ålbum","Mem√≥ria"],
      ["Rua","Cal√ßada","Pedestre","Faixa","Tr√¢nsito"],
      ["Estudo","Foco","Concentra√ß√£o","Sil√™ncio","Resultado"],
      ["Praia","Cadeira","Guarda-sol","Descanso","Brisa"],
      ["Cama","Travesseiro","Sono","Descanso","Sonho"],
      ["Restaurante","Card√°pio","Gar√ßom","Pedido","Conta"],
      ["Igreja","F√©","Ora√ß√£o","Louvor","Esperan√ßa"],
      ["Anivers√°rio","Bolo","Vela","Parab√©ns","Festa"],
      ["Chuva","Po√ßa","Guarda-chuva","Pingos","Molhado"],
      ["Escrit√≥rio","Computador","Mesa","Relat√≥rio","Trabalho"],
      ["Jantar","Mesa","Fam√≠lia","Conversa","Refei√ß√£o"],
      ["Hospital","Enfermagem","Plant√£o","Emerg√™ncia","Cuidado"],
      ["Brinquedo","Quebra-cabe√ßa","Pe√ßa","Montar","Paci√™ncia"],
      ["Religi√£o","B√≠blia","Ensino","Palavra","Amor"],
      ["Avi√£o","Decolagem","Asa","Viagem","Altura"],
      ["Cabelo","Escova","Corte","Espelho","Sal√£o"],
      ["Compras","Sacola","Loja","Promo√ß√£o","Pre√ßo"],
      ["Escola","L√°pis","Borracha","Escrita","Caderno"],
      ["Ver√£o","Piscina","Mergulho","Frescor","Sol"],
      ["Inverno","Cobertor","Frio","Pregui√ßa","Chocolate"],
      ["Festa","Convite","Lista","Amigos","Encontro"],
      ["Bicicleta","Pedal","Equil√≠brio","Capacete","Passeio"],
      ["Professor","Explica√ß√£o","Quadro","Aula","Ensino"],
      ["Dinheiro","Banco","Cart√£o","Senha","Conta"],
      ["Televis√£o","Controle","Canal","Volume","Sof√°"],
      ["Viagem","Estrada","Parada","Destino","Caminho"],
      ["Feira","Barraca","Fruta","Feira-livre","Sacola"],
      ["Cozinha","Prato","Talher","Receita","Sabor"],
      ["Academia","Esteira","Corrida","F√¥lego","Suor"],
      ["Crian√ßa","Escola","Mochila","Lanche","Aprender"],
      ["Casamento","Alian√ßa","Amor","Festa","Uni√£o"],
      ["Internet","V√≠deo","Curtida","Coment√°rio","Compartilhar"],
      ["Tr√¢nsito","Farol","Parada","Aten√ß√£o","Sinal"],
      ["Almo√ßo","Arroz","Feij√£o","Prato","Caseiro"],
      ["Escola","Prova","Nota","Estudo","Resultado"],
      ["Noite","Sil√™ncio","Lua","Estrelas","Descanso"],
      ["Trabalho","Esfor√ßo","Dedica√ß√£o","Meta","Conquista"],
      ["Crian√ßa","Desenho","L√°pis","Cor","Criatividade"],
      ["Natal","Ceia","Fam√≠lia","Uni√£o","Gratid√£o"],
      ["Ano Novo","Esperan√ßa","Recome√ßo","Planos","Futuro"],
      ["Escola","Formatura","Diploma","Orgulho","Conquista"],
      ["Campo","Grama","Ar Livre","Natureza","Descanso"],
      ["Carro","Volante","Estrada","Dire√ß√£o","Viagem"],
      ["Cachorro","Passeio","Guia","Rua","Alegria"],
      ["Gato","Bigode","Sof√°","Pregui√ßa","Miado"],
      ["Churrasco","Grelha","Carne","Amigos","Fim de semana"],
      ["Escola","Amizade","Grupo","Trabalho","Uni√£o"],
      ["Cuidado","Aten√ß√£o","Respeito","Empatia","Amor"],
      ["Parque","√Årvore","Banco","Caminhada","Lazer"],
      ["Celular","Notifica√ß√£o","Mensagem","Alerta","Som"],
      ["Manh√£","Despertador","Sono","Caf√©","Pressa"],
      ["Tarde","Trabalho","Sol","Movimento","Rotina"],
      ["Noite","Jantar","Descanso","Fam√≠lia","Conversa"],
      ["Escola","Biblioteca","Sil√™ncio","Leitura","Estudo"],
      ["Praia","Caminhada","Areia","Pegada","Mar"],
      ["Feira","Pastel","Caldo","Encontro","Tradi√ß√£o"],
      ["Trabalho","Equipe","Uni√£o","Resultado","Sucesso"],
      ["Crian√ßa","Colo","Prote√ß√£o","Seguran√ßa","Amor"],
      ["Escola","Professor","Inspira√ß√£o","Ensino","Futuro"],
      ["Cidade","Bairro","Comunidade","Pessoas","Vida"],
      ["Igreja","Comunh√£o","Encontro","Palavra","F√©"],
      ["Casa","Lar","Aconchego","Seguran√ßa","Fam√≠lia"],
      ["Amigo","Confian√ßa","Conversa","Apoio","Verdade"],
      ["Trabalho","Hor√°rio","Compromisso","Rotina","Disciplina"],
      ["Escola","Educa√ß√£o","Base","Conhecimento","Futuro"],
      ["Festa","M√∫sica","Dan√ßa","Energia","Alegria"],
      ["Sil√™ncio","Paz","Calma","Tranquilidade","Equil√≠brio"],
      ["Desafio","Supera√ß√£o","For√ßa","Persist√™ncia","Vit√≥ria"],
      ["Esperan√ßa","F√©","Confian√ßa","Caminho","Luz"],
      ["Gratid√£o","Reconhecimento","Respeito","Amor","Valor"],
      ["Futuro","Sonho","Planejamento","Dedica√ß√£o","Conquista"],
      ["Vida","Tempo","Escolhas","Caminhos","Aprendizado"],
      ["Jogo","Divers√£o","Risada","Amigos","Mem√≥ria"],
    ];

    // ======= ELEMENTOS =======
    const elBody       = document.body;
    const elCard3d     = document.getElementById("card3d");
    const elCardNumber = document.getElementById("cardNumber");
    const elRemaining  = document.getElementById("remaining");
    const elPicked     = document.getElementById("pickedNumber");
    const elWords      = document.getElementById("words");
    const showTarget   = document.getElementById("showTarget");
    const targetBox    = document.getElementById("targetBox");
    const targetN      = document.getElementById("targetN");
    const targetWord   = document.getElementById("targetWord");
    const festaToggle  = document.getElementById("festaToggle");
    const adivToggle   = document.getElementById("adivToggle");
    const modeLabel    = document.getElementById("modeLabel");
    const hintText     = document.getElementById("hintText");

    // ======= ESTADO =======
    let shuffled = [];
    let idx = 0;
    let currentCard = null;
    let pickedNumber = null;
    let flippingLock = false;

    // ======= UTIL =======
    function fisherYates(array) {
      const a = array.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function updateMeta() {
      elCardNumber.textContent = currentCard ? String(idx) : "‚Äî";
      elRemaining.textContent = String(shuffled.length - idx);
    }

    function updateTargetVisibility() {
      const isAdiv = elBody.classList.contains("adivinhador");
      const shouldShow = !isAdiv && showTarget.checked && currentCard && pickedNumber;

      targetBox.style.display = shouldShow ? "block" : "none";

      if (currentCard && pickedNumber) {
        targetN.textContent = String(pickedNumber);
        targetWord.textContent = currentCard[pickedNumber - 1];
      } else {
        targetN.textContent = "‚Äî";
        targetWord.textContent = "‚Äî";
      }
    }

    function renderCard(card) {
      elWords.innerHTML = "";
      card.forEach((w, i) => {
        const div = document.createElement("div");
        div.className = `word c${i+1}`; // cor por posi√ß√£o
        div.innerHTML = `<span>${w}</span><span class="idx">${i+1}</span>`;
        elWords.appendChild(div);
      });
      updateTargetVisibility();
    }

    // ======= FLIP ANIMATION =======
    function flipToNextCard() {
      if (flippingLock) return;
      flippingLock = true;

      // 1) vira (mostra o "verso")
      elCard3d.classList.add("flipping");

      // 2) no meio do flip, troca o conte√∫do
      window.setTimeout(() => {
        drawNextCardInternal();
      }, 260);

      // 3) volta (frente)
      window.setTimeout(() => {
        elCard3d.classList.remove("flipping");
        window.setTimeout(() => { flippingLock = false; }, 80);
      }, 540);
    }

    // ======= CICLO DO BARALHO =======
    function resetCycle() {
      shuffled = fisherYates(DECK);
      idx = 0;
      currentCard = null;
      pickedNumber = null;
      elPicked.textContent = "‚Äî";
      showTarget.checked = false;
      drawNextCardInternal();
    }

    function drawNextCardInternal() {
      if (idx >= shuffled.length) {
        shuffled = fisherYates(DECK);
        idx = 0;
      }

      currentCard = shuffled[idx];
      idx += 1;

      pickedNumber = null;
      elPicked.textContent = "‚Äî";
      renderCard(currentCard);
      updateMeta();
    }

    function pickNumber() {
      pickedNumber = Math.floor(Math.random() * 5) + 1;
      elPicked.textContent = String(pickedNumber);
      updateTargetVisibility();
    }

    // ======= MODO FESTA (confete sutil) =======
    const confetti = document.getElementById("confetti");
    const ctx = confetti.getContext("2d", { alpha: true });

    function resizeConfetti(){
      confetti.width = window.innerWidth;
      confetti.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeConfetti);
    resizeConfetti();

    const confettiState = {
      on: false,
      pieces: [],
      lastTime: 0
    };

    function spawnConfetti(n=18){
      const w = confetti.width, h = confetti.height;
      for (let i=0;i<n;i++){
        confettiState.pieces.push({
          x: Math.random()*w,
          y: -20 - Math.random()*h*0.3,
          r: 3 + Math.random()*4,
          vx: -0.6 + Math.random()*1.2,
          vy: 0.8 + Math.random()*1.6,
          rot: Math.random()*Math.PI*2,
          vr: (-0.08 + Math.random()*0.16),
          // sem setar cor fixa via CSS; aqui s√£o varia√ß√µes internas ‚Äúfesta‚Äù
          hue: Math.floor(Math.random()*360),
          life: 1,
        });
      }
    }

    function stepConfetti(t){
      if (!confettiState.on) return;

      if (!confettiState.lastTime) confettiState.lastTime = t;
      const dt = Math.min(32, t - confettiState.lastTime);
      confettiState.lastTime = t;

      const w = confetti.width, h = confetti.height;

      // spawn leve
      if (Math.random() < 0.12) spawnConfetti(8);

      ctx.clearRect(0,0,w,h);

      confettiState.pieces.forEach(p => {
        p.x += p.vx * dt;
        p.y += p.vy * dt;
        p.rot += p.vr * dt;
        p.life *= 0.999;

        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.globalAlpha = 0.55;
        ctx.fillStyle = `hsl(${p.hue} 90% 60%)`;
        ctx.fillRect(-p.r, -p.r*0.55, p.r*2, p.r*1.1);
        ctx.restore();
      });

      // remove os que sa√≠ram
      confettiState.pieces = confettiState.pieces.filter(p => p.y < h + 40 && p.x > -80 && p.x < w + 80);

      requestAnimationFrame(stepConfetti);
    }

    function setFestaMode(on){
      elBody.classList.toggle("festa", on);
      confettiState.on = on;
      if (on){
        spawnConfetti(26);
        confettiState.lastTime = 0;
        requestAnimationFrame(stepConfetti);
      } else {
        ctx.clearRect(0,0,confetti.width, confetti.height);
        confettiState.pieces = [];
      }
    }

    // ======= MODO ADIVINHADOR =======
    function setAdivinhadorMode(on){
      elBody.classList.toggle("adivinhador", on);
      modeLabel.textContent = on ? "Adivinhador" : "Mestre";

      if (on){
        hintText.textContent = "Voc√™ n√£o v√™ o n√∫mero nem o alvo. Use o outro celular/tela como Mestre.";
        showTarget.checked = false;
        elPicked.textContent = "‚Äî";
        pickedNumber = null;
      } else {
        hintText.textContent = "Dica: no jogo original, o ‚Äúalvo‚Äù costuma ficar s√≥ com o grupo. Aqui voc√™ controla.";
      }
      updateTargetVisibility();
    }

    // ======= EVENTOS =======
    document.getElementById("nextBtn").addEventListener("click", flipToNextCard);
    document.getElementById("pickBtn").addEventListener("click", pickNumber);
    document.getElementById("resetBtn").addEventListener("click", () => {
      // reset com flip (bonitinho)
      if (flippingLock) return;
      flippingLock = true;
      elCard3d.classList.add("flipping");
      window.setTimeout(() => { resetCycle(); }, 260);
      window.setTimeout(() => {
        elCard3d.classList.remove("flipping");
        window.setTimeout(() => { flippingLock = false; }, 80);
      }, 540);
    });

    showTarget.addEventListener("change", updateTargetVisibility);

    festaToggle.addEventListener("change", (e) => setFestaMode(e.target.checked));
    adivToggle.addEventListener("change", (e) => setAdivinhadorMode(e.target.checked));

    // ======= INICIALIZA =======
    resetCycle();
    setFestaMode(false);
    setAdivinhadorMode(false);
  </script>
</body>
</html>
